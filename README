STILL VERY DIRTY CODE, WILL CLEAN UP WHEN GOT TIME